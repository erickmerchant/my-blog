{% extends "layouts/base.jinja" %}

{% macro rss_link(title, href) %}
<p>
	<a class="rss-link" href="/{{href}}/feed.rss">
		<svg viewBox="0 0 8 8">
			<circle cx="2" cy="6" r="1" />
			<path d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z" />
			<path d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z" />
		</svg>
		{{title}}
	</a>
</p>
{% endmacro %}

{% macro sub_heading(entry, tags) %}
{% if entry.date or tags %}
<div class="sub-heading">
	{% if entry.date %}
	<p class="published">
		<time>{{entry.date | format_date("%B %e, %Y")}}</time>
	</p>
	{% endif %}
	{% if tags %}
	<ul class="tags">
		{% for t in tags %}
		<li><a href="/tags/{{t.slug}}/">{{t.slug}}</a></li>
		{% endfor %}
	</ul>
	{% endif %}
</div>
{% endif %}
{% endmacro %}

{% block title %}
{{site.title}} {% if entry.title %}â€” {{entry.title}}{% else %}Untitled{% endif %}
{% endblock %}

{% block modules %}
{% for k in entry.elements %}
<script type="module" src="{{ '/elements/' + k + '.js' }}"></script>
{% endfor %}
{% endblock %}

{% block stylesheets %}
{% for k in entry.elements %}
<link rel="preload" href="{{ '/elements/' + k + '.css' }}" as="style">
{% endfor %}
{% endblock %}

{% block main %}
<header>
	<h1>{% if entry.title %}{{entry.title}}{% else %}Untitled{% endif %}</h1>
	{{sub_heading(entry, entry_tags)}}
</header>

{{entry.content}}

{% if feed %}
<ol class="index">
	{% for (e, tags) in feed %}
	<li>
		<header>
			<h2><a href="/{{e.category}}/{{e.slug}}/">{% if e.title %}{{e.title}}{% else %}Untitled{% endif %}</a></h2>
			{{sub_heading(e, tags)}}
		</header>
		{% if e.description %}
		<p>{{e.description}}</p>
		{% endif %}
	</li>
	{% endfor %}
</ol>
{% endif %}
{% endblock %}

{% block footer %}
{{rss_link("RSS for all posts", "categories/posts")}}
{% endblock %}
