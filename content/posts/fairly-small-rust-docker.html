<front-matter>
{
	"title": "Fairly small rust + docker",
	"date": "2023-08-19",
	"description": "How to get fairly small docker images for rust projects. A walk through of my Dockerfile.",
	"tags": ["rust", "docker"]
}
</front-matter>

<p>Like me you may be sort of obsessed with getting the smallest docker image for your rust server. This is the best way I've found. The following is an example Dockerfile, slightly simplified from the one I actually use</p>

<code-block language="dockerfile">
FROM rust:1.71-alpine as build
RUN apk add build-base
WORKDIR deploy
# cache deps
RUN mkdir -p src
RUN echo "fn main() {}" > src/main.rs
COPY Cargo.toml Cargo.lock .
RUN cargo build --release --no-default-features --locked
# build app
COPY . .
RUN cargo build --release --no-default-features --locked
RUN mv ./target/release/your-app ./your-app
# clean up
RUN rm -rf target src Cargo.lock Cargo.toml

FROM scratch
WORKDIR /deploy
COPY --from=build /deploy .
ENTRYPOINT ["./your-app"]
</code-block>
